---
title: 网络
---
<Note>
对于大多数Web开发、API调用、微服务通信，使用Http层协议工具（特别是requests库）完全足够且是正确选。只有需要低级别的网络服务（涉及到TCP/IP等）才推荐使用 Socket协议工具
</Note>

## HTTP 客户端
https://httpbin.org 是一个HTTP 请求测试和调试服务，你发送什么请求给它，它就返回什么相关信息给你，非常方便用于学习和调试。


### 发请求
```py
import requests

# 最简单的GET请求
response = requests.get('https://httpbin.org/get?name=John&age=30')
print(response.status_code)  # 200
print(response.text)         # 响应内容


# POST发送表单数据（application/x-www-form-urlencoded）
data = {'username': 'admin', 'password': 'secret'}
response = requests.post('https://httpbin.org/post', data=data)
print(response.text)

# POST发送JSON数据（application/json）
json_data = {'name': 'John', 'age': 30}
response = requests.post('https://httpbin.org/post', json=json_data)
print(response.text)
```


### 响应处理
```py
response = requests.get('https://api.github.com')

# 状态码
print(response.status_code)
print(response.ok)  # 状态码为200-400时返回True

# 响应内容
print(response.text)      # 字符串内容
print(response.content)   # 字节内容
print(response.json())    # JSON内容（如果是JSON）

# 响应头
print(response.headers)
print(response.headers['Content-Type'])

# 编码处理
response.encoding = 'utf-8'  # 设置编码
print(response.encoding)

# 获取原始响应（用于流式传输）
raw_response = response.raw
```


### 请求配置
#### 请求头
```py
headers = {
    'User-Agent': 'Mozilla/5.0',
    'Authorization': 'Bearer token123',
    'Content-Type': 'application/json',
    'X-Custom-Header': 'value'
}

response = requests.get('https://httpbin.org/headers', headers=headers)
```

#### 超时设置
```py
# 连接+读取总超时
response = requests.get('https://httpbin.org/delay/5', timeout=3)

# 分别设置连接和读取超时
response = requests.get('https://httpbin.org/delay/2', timeout=(1, 3))
```

#### 代理
```py
proxies = {
    'http': 'http://10.10.1.10:3128',
    'https': 'http://10.10.1.10:1080',
}

response = requests.get('http://example.org', proxies=proxies)
``` 


#### 会话
Session（会话）是requests库中的一个重要概念，它相当于在多个请求之间保持一些"状态"。比如需要登录认证的网站
```py
import requests

# ❌ 错误方式 - 登录状态不会保持
requests.post('https://example.com/login', data={'user': 'admin', 'pass': '123'})
response = requests.get('https://example.com/profile')  # 未登录状态！

# ✅ 正确方式 - 使用Session保持登录状态
session = requests.Session()
session.headers.update({"Authorization": f"Bearer xxx"})  # 设置一次

# 登录请求
login_data = {'username': 'admin', 'password': '123456'}
session.post('https://example.com/login', data=login_data)

# 后续请求自动携带cookie 和 header 信息
profile = session.get('https://example.com/profile')  # 已登录状态
dashboard = session.get('https://example.com/dashboard')
logout = session.get('https://example.com/logout')
```


## HTTP 服务端
HTTPServer 是 Python 标准库中的一个模块，用于创建 HTTP 服务器。但是由于写起来较为麻烦大家都不会直接使用，而是使用第三方库来创建HTTP 服务端。比如Flask、FastAPI、Django等。目前主流是Flask，未来趋势是FastAPI。
我们这里仍然以当前主流库Flask为例来介绍HTTP 服务端。

### 快速开始
Flask 是一个轻量级的 Python 框架，用于构建 Web 应用程序。它非常流行，因为它的学习曲线平缓，功能强大，且社区支持良好。

```py
from flask import Flask, request, jsonify

app = Flask(__name__)

# 基本路由
@app.route('/')
def home():
    return '首页'

# GET 请求带参数
@app.route('/user/<username>')
def show_user(username):
    return f'用户: {username}'

# GET 查询参数
@app.route('/search')
def search():
    keyword = request.args.get('q', '')
    page = request.args.get('page', '1')
    return f'搜索: {keyword}, 第 {page} 页'

# POST 请求处理
@app.route('/login', methods=['POST'])
def login():
    username = request.form.get('username')
    password = request.form.get('password')
    # 或者处理 JSON
    # data = request.get_json()
    return f'登录成功: {username}'

# 同时处理 GET 和 POST
@app.route('/api/data', methods=['GET', 'POST'])
def handle_data():
    if request.method == 'GET':
        return jsonify({'method': 'GET', 'message': '获取数据'})
    else:
        data = request.get_json()
        return jsonify({'method': 'POST', 'received': data})

if __name__ == '__main__':
    app.run(debug=True, port=5000)
```
