---
title: æ ‡è®°
---

`@pytest.mark` æ˜¯ Pytest ä¸€ä¸ªè£…é¥°å™¨ï¼Œç”¨äºç»™æµ‹è¯•ç”¨ä¾‹æ·»åŠ æ ‡è®°ï¼Œè¿™äº›æ ‡è®°é™¤äº†èƒ½å¯¹å¯¹æµ‹è¯•è¿›è¡Œåˆ†ç±»ã€è¿‡æ»¤å¤–ï¼Œè¿˜èƒ½ç»™è¢«è£…é¥°çš„å‡½æ•°ä¸€äº›é¢å¤–çš„åŠŸèƒ½ï¼



## å¤¹å…·çš„åˆ†ç±»
æˆ‘ä»¬æŒ‰ç…§æœ‰æ— åŠŸèƒ½å°† æ ‡è®°åˆ†ä¸ºï¼š åŠŸèƒ½æ€§æ ‡è®° å’Œ æ— åŠŸèƒ½æ€§æ ‡è®° ä¸¤å¤§ç±»

| ç±»åˆ« | ç‰¹ç‚¹ | ä¸»è¦ç”¨é€” | æ˜¯å¦å½±å“æµ‹è¯•é€»è¾‘ |
|------|------|----------|----------------|
| **åŠŸèƒ½æ€§æ ‡è®°** | ä¼šæ”¹å˜æµ‹è¯•çš„æ‰§è¡Œæ–¹å¼ | å‚æ•°åŒ–ã€è·³è¿‡ã€é¢„æœŸå¤±è´¥ | âœ… ç›´æ¥å½±å“ |
| **æ— åŠŸèƒ½æ€§æ ‡è®°** | ä»…æ·»åŠ å…ƒæ•°æ®/æ ‡ç­¾ | åˆ†ç±»ã€ç­›é€‰ã€åˆ†ç»„ | âŒ ä¸å½±å“é€»è¾‘ |


## æ— åŠŸèƒ½æ€§å¤¹å…·
pytest çš„æ‰€æœ‰å†…ç½® mark éƒ½æ˜¯åŠŸèƒ½æ€§æ ‡è®°ï¼Œç”¨æˆ·è‡ªå®šä¹‰æ ‡è®°åˆ™æ˜¯æ— åŠŸèƒ½æ ‡è®°ï¼

é¦–å…ˆæˆ‘ä»¬éœ€è¦ Pytest é…ç½®æ–‡ä»¶ä¸­æ³¨å†Œè‡ªå®šä¹‰çš„ markï¼Œä»¥é¿å…è­¦å‘Šå¦‚ï¼š
```ini title="pytest.ini"
[pytest]
# è‡ªå®šä¹‰mark
markers =
    p0: P0æ ¸å¿ƒæµ‹è¯•ç”¨ä¾‹
    p1: P1é‡è¦åŠŸèƒ½æµ‹è¯•ç”¨ä¾‹
    performance: æ€§èƒ½æµ‹è¯•ç”¨ä¾‹
    api: æ™®é€šAPIæ¥å£æµ‹è¯•

```

æœ€åä½¿ç”¨å³å¯ï¼ˆç»™æµ‹è¯•ç”¨ä¾‹æ‰“æ‰“æ ‡è®°ï¼‰
```py
import pytest

@pytest.mark.p0
def test_one():
    assert 1==1

@pytest.mark.p0
def test_two():
    assert 1==1

@pytest.mark.p1
def test_three():
    assert 1==1
```

å¯ä»¥ç­›é€‰å‡ºä»…ç¬¦åˆæ¡ä»¶çš„ç”¨ä¾‹å»è·‘æµ‹è¯•ï¼Œæ¯”å¦‚
```bash
pytest -m p0
```

å¦å¤–æˆ‘ä»¬è¿˜å¯ä»¥æ ¹æ®æ ‡ç­¾ç”Ÿæˆæµ‹è¯•ç»“æœåˆ†ç»„ç»Ÿè®¡ï¼Œpytest åŸç”Ÿä¸å®Œå…¨æ”¯æŒè¿™ä¸ªåŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥ `pytest-html`æ¥è§£å†³ï¼Œ `pip install pytest-html`
```bash
# ç”ŸæˆHTMLæŠ¥å‘Šï¼Œä¼šæŒ‰æ ‡è®°åˆ†ç»„
pytest --html=report.html --self-contained-html
```

## åŠŸèƒ½æ€§å¤¹å…·
å¦‚ä¸Šæ‰€æï¼Œpytestå†…ç½®äº†å¾ˆå¤šåŠŸèƒ½æ€§markä¾›æˆ‘ä»¬ä½¿ç”¨ï¼
```py
# è·³è¿‡åŠŸèƒ½
@pytest.mark.skip(reason="Bug #123 æœªä¿®å¤")
def test_broken_feature():
    assert False  # ğŸš« è¿™ä¸ªæµ‹è¯•ä¸ä¼šæ‰§è¡Œï¼

# è¶…æ—¶åŠŸèƒ½ï¼ˆéœ€è¦æ’ä»¶ï¼‰
@pytest.mark.timeout(5)  # 5ç§’è¶…æ—¶
def test_slow_operation():
    time.sleep(10)  # ğŸ• 10ç§’åä¼šè¶…æ—¶å¤±è´¥
    assert True

# å‚æ•°åŒ–æµ‹è¯•åŠŸèƒ½ï¼ˆè¿™ä¸ªå•ç‹¬è®²ï¼Œæ¯”è¾ƒé‡è¦ï¼‰
@pytest.mark.parametrize(...)
def test_addition():
    pass
```

### å‚æ•°åŒ–æ ‡è®°
`@pytest.mark.parametrize`ï¼Œæ˜¯pytestå†…ç½®çš„ä¸€ä¸ªéå¸¸å¼ºå¤§ä¸”é‡è¦çš„åŠŸèƒ½æ€§æ ‡è®°ï¼Œæ ¸å¿ƒåŠŸèƒ½å°±æ˜¯ï¼šè®©ä¸€ä¸ªæµ‹è¯•å‡½æ•°ä½¿ç”¨ä¸åŒçš„å‚æ•°è¿è¡Œå¤šæ¬¡ï¼

```py
arg_values=[] # åˆ—è¡¨ï¼šå‚æ•°å€¼åˆ—è¡¨
# ä½¿ç”¨æ–¹å¼å¦‚ä¸‹: ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å­—ç¬¦ä¸²ç±»å‹çš„å‚æ•°åï¼Œç”¨é€—å·åˆ†éš”
@pytest.mark.parametrize( "arg_names",  arg_values)
```

#### å•å‚æ•°æµ‹è¯•ç”¨ä¾‹
```py
import pytest

@pytest.mark.parametrize("number", [-1, 2, 3, 4, 5])
def test_is_positive(number):
    assert number > 0
```
è¿è¡Œä¹‹åï¼Œå¯ä»¥çœ‹åˆ°æµ‹è¯•ç”¨ä¾‹test_is_positiveè·‘äº†5æ¬¡ï¼ˆ1æ¬¡å¤±è´¥+4æ¬¡æˆåŠŸï¼‰
![](https://img.dingshaohua.com/doc-python/parametrize-simple-20251207021057.jpg)

å•ä¸ªå‚æ•°çš„å€¼é™¤äº†æ˜¯åŸºæœ¬ç±»å‹ï¼Œè¿˜å¯ä»¥æ˜¯å¤æ‚ç‚¹çš„ç±»å‹ï¼Œæ¯”å¦‚å­—å…¸
```py
import pytest

# ç®€å•çš„å­—å…¸å‚æ•°ï¼ŒåŒ…å«ä¸­æ–‡åå­—å’Œå¹´é¾„
@pytest.mark.parametrize("user_info", [
    {"name": "å¼ ä¸‰", "age": 25},
    {"name": "æå››", "age": 30},
])
def test_chinese_user_info(user_info):
    print(f"ç”¨æˆ·: {user_info['name']}, å¹´é¾„: {user_info['age']}")
    
    # éªŒè¯æ•°æ®å­˜åœ¨
    assert "name" in user_info
    assert "age" in user_info
    
    # éªŒè¯ä¸­æ–‡åå­—ï¼ˆ2-3ä¸ªæ±‰å­—ï¼‰
    assert isinstance(user_info["name"], str)
    assert 2 <= len(user_info["name"]) <= 3
    
    # éªŒè¯å¹´é¾„èŒƒå›´
    assert isinstance(user_info["age"], int)
    assert 18 <= user_info["age"] <= 60  # åˆç†çš„å¹´é¾„èŒƒå›´
```

#### å¤šå‚æ•°æµ‹è¯•ç”¨ä¾‹
```py
import pytest

params_value = [(1, 2),(3, 4),(5, 6)]
@pytest.mark.parametrize("x,y",params_value)
def test_coordinates(x, y):
    assert x < y

# è¿è¡Œæµ‹è¯•ç”¨ä¾‹åï¼Œä¼šå‘ç°è¯¥ç”¨ä¾‹è¢«æ‰§è¡Œ3æ¬¡ï¼Œå‡ä¸ºæˆåŠŸï¼
```

#### å‚æ•°åˆ«åids
å…¶å®è¿˜æ”¯æŒç¬¬ä¸‰ä¸ªå‚æ•°`@pytest.mark.parametrize(params_name,params_value, ids)`     
ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ idsä¸ºå¯é€‰å‚æ•°ï¼Œç”¨æ¥ç»™æ¯ç»„å‚æ•°èµ·ä¸€ä¸ªå¯è¯»çš„åå­—ï¼Œä¹Ÿæ˜¯åˆ—è¡¨ç±»å‹ï¼Œä¸»è¦ç”¨äºæé«˜æµ‹è¯•æŠ¥å‘Šå¯è¯»æ€§ã€‚
```py
import pytest

# ä¸ä½¿ç”¨ ids
@pytest.mark.parametrize("name,age", [
    ("å¼ ä¸‰", 25),
    ("æå››", 30),
    ("ç‹äº”", 35)
])
def test_without_ids(name, age):
    assert age > 20

# ä½¿ç”¨ ids
@pytest.mark.parametrize(
    "name,age",
    [
        ("å¼ ä¸‰", 25),
        ("æå››", 30),
        ("ç‹äº”", 35)
    ],
    ids=[
        "å¹´è½»å‘˜å·¥-å¼ ä¸‰",
        "ä¸­å¹´å‘˜å·¥-æå››", 
        "èµ„æ·±å‘˜å·¥-ç‹äº”"
    ] # ids æ•°é‡å¿…é¡»å’Œå‚æ•°å€¼åŒ¹é…
)
def test_with_ids(name, age):
    assert age > 20
```

è¿è¡Œæµ‹è¯•åçš„ç»“æœæ˜¯
```bash
# ä¸ä½¿ç”¨ idsè¾“å‡ºï¼š
test_demo.py::test_without_ids[å¼ ä¸‰-25] âœ“
test_demo.py::test_without_ids[æå››-30] âœ“  
test_demo.py::test_without_ids[ç‹äº”-35] âœ“


# ä½¿ç”¨ idsè¾“å‡ºï¼š
test_demo.py::test_with_ids[å¹´è½»å‘˜å·¥-å¼ ä¸‰] âœ“
test_demo.py::test_with_ids[ä¸­å¹´å‘˜å·¥-æå››] âœ“
test_demo.py::test_with_ids[èµ„æ·±å‘˜å·¥-ç‹äº”] âœ“
```

### å¤¹å…·è§¦å‘æ ‡è®°
å€ŸåŠ©å†…ç½® mark `@pytest.mark.usefixtures`ï¼Œæˆ‘ä»¬ä¹Ÿèƒ½ç»™æµ‹è¯•å‡½æ•°è§¦å‘å¤¹å…·ç”Ÿå‘½å‘¨æœŸï¼Œå¦‚ä¸‹ï¼š
```py
@pytest.mark.usefixtures("my_fixture")
def test_fix():
    print("æµ‹è¯•ç”¨ä¾‹æ‰§è¡Œ")
```

è¿™ä¸ªæˆ‘ä»¬ä¸‹ä¸€ç« èŠ‚å…·ä½“è®²ï¼